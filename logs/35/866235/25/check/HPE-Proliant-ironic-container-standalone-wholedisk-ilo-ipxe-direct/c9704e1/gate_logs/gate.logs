SHELL=/bin/bash
no_proxy=127.0.0.1,169.16.1.1,169.16.1.2,169.16.1.3,169.16.1.4,169.16.1.5,169.16.1.6,169.16.1.7,169.16.1.8,169.16.1.9,169.16.1.10,169.16.1.11,169.16.1.12,169.16.1.13,169.16.1.14,169.16.1.15,169.16.1.16,169.16.1.17,169.16.1.18,169.16.1.19,169.16.1.20,169.16.1.21,169.16.1.22,169.16.1.23,169.16.1.24,169.16.1.25,169.16.1.26,169.16.1.27,169.16.1.28,169.16.1.29,169.16.1.30,169.16.1.31,169.16.1.32,169.16.1.33,169.16.1.34,169.16.1.35,169.16.1.36,169.16.1.37,169.16.1.38,169.16.1.39,169.16.1.40,169.16.1.41,169.16.1.42,169.16.1.43,169.16.1.44,169.16.1.45,169.16.1.46,169.16.1.47,169.16.1.48,169.16.1.49,169.16.1.50,169.16.1.51,169.16.1.52,169.16.1.53,169.16.1.54,169.16.1.55,169.16.1.56,169.16.1.57,169.16.1.58,169.16.1.59,169.16.1.60,169.16.1.61,169.16.1.62,169.16.1.63,169.16.1.64,169.16.1.65,169.16.1.66,169.16.1.67,169.16.1.68,169.16.1.69,169.16.1.70,169.16.1.71,169.16.1.72,169.16.1.73,169.16.1.74,169.16.1.75,169.16.1.76,169.16.1.77,169.16.1.78,169.16.1.79,169.16.1.80,169.16.1.81,169.16.1.82,169.16.1.83,169.16.1.84,169.16.1.85,169.16.1.86,169.16.1.87,169.16.1.88,169.16.1.89,169.16.1.90,169.16.1.91,169.16.1.92,169.16.1.93,169.16.1.94,169.16.1.95,169.16.1.96,169.16.1.97,169.16.1.98,169.16.1.99,169.16.1.100,169.16.1.101,169.16.1.102,169.16.1.103,169.16.1.104,169.16.1.105,169.16.1.106,169.16.1.107,169.16.1.108,169.16.1.109,169.16.1.110,169.16.1.111,169.16.1.112,169.16.1.113,169.16.1.114,169.16.1.115,169.16.1.116,169.16.1.117,169.16.1.118,169.16.1.119,169.16.1.120,169.16.1.121,169.16.1.122,169.16.1.123,169.16.1.124,169.16.1.125,169.16.1.126,169.16.1.127,169.16.1.128,169.16.1.129,169.16.1.130,169.16.1.131,169.16.1.132,169.16.1.133,169.16.1.134,169.16.1.135,169.16.1.136,169.16.1.137,169.16.1.138,169.16.1.139,169.16.1.140,169.16.1.141,169.16.1.142,169.16.1.143,169.16.1.144,169.16.1.145,169.16.1.146,169.16.1.147,169.16.1.148,169.16.1.149,169.16.1.150,169.16.1.151,169.16.1.152,169.16.1.153,169.16.1.154,169.16.1.155,169.16.1.156,169.16.1.157,169.16.1.158,169.16.1.159,169.16.1.160,169.16.1.161,169.16.1.162,169.16.1.163,169.16.1.164,169.16.1.165,169.16.1.166,169.16.1.167,169.16.1.168,169.16.1.169,169.16.1.170,169.16.1.171,169.16.1.172,169.16.1.173,169.16.1.174,169.16.1.175,169.16.1.176,169.16.1.177,169.16.1.178,169.16.1.179,169.16.1.180,169.16.1.181,169.16.1.182,169.16.1.183,169.16.1.184,169.16.1.185,169.16.1.186,169.16.1.187,169.16.1.188,169.16.1.189,169.16.1.190,169.16.1.191,169.16.1.192,169.16.1.193,169.16.1.194,169.16.1.195,169.16.1.196,169.16.1.197,169.16.1.198,169.16.1.199,169.16.1.200,169.16.1.201,169.16.1.202,169.16.1.203,169.16.1.204,169.16.1.205,169.16.1.206,169.16.1.207,169.16.1.208,169.16.1.209,169.16.1.210,169.16.1.211,169.16.1.212,169.16.1.213,169.16.1.214,169.16.1.215,169.16.1.216,169.16.1.217,169.16.1.218,169.16.1.219,169.16.1.220,169.16.1.221,169.16.1.222,169.16.1.223,169.16.1.224,169.16.1.225,169.16.1.226,169.16.1.227,169.16.1.228,169.16.1.229,169.16.1.230,169.16.1.231,169.16.1.232,169.16.1.233,169.16.1.234,169.16.1.235,169.16.1.236,169.16.1.237,169.16.1.238,169.16.1.239,169.16.1.240,169.16.1.241,169.16.1.242,169.16.1.243,169.16.1.244,169.16.1.245,169.16.1.246,169.16.1.247,169.16.1.248,169.16.1.249,169.16.1.250,169.16.1.251,169.16.1.252,169.16.1.253,169.16.1.254,169.16.1.255,156.15.1.1,156.15.1.2,156.15.1.3,156.15.1.4,156.15.1.5,156.15.1.6,156.15.1.7,156.15.1.8,156.15.1.9,156.15.1.10,156.15.1.11,156.15.1.12,156.15.1.13,156.15.1.14,156.15.1.15,156.15.1.16,156.15.1.17,156.15.1.18,156.15.1.19,156.15.1.20,156.15.1.21,156.15.1.22,156.15.1.23,156.15.1.24,156.15.1.25,156.15.1.26,156.15.1.27,156.15.1.28,156.15.1.29,156.15.1.30,156.15.1.31,156.15.1.32,156.15.1.33,156.15.1.34,156.15.1.35,156.15.1.36,156.15.1.37,156.15.1.38,156.15.1.39,156.15.1.40,156.15.1.41,156.15.1.42,156.15.1.43,156.15.1.44,156.15.1.45,156.15.1.46,156.15.1.47,156.15.1.48,156.15.1.49,156.15.1.50,156.15.1.51,156.15.1.52,156.15.1.53,156.15.1.54,156.15.1.55,156.15.1.56,156.15.1.57,156.15.1.58,156.15.1.59,156.15.1.60,156.15.1.61,156.15.1.62,156.15.1.63,156.15.1.64,156.15.1.65,156.15.1.66,156.15.1.67,156.15.1.68,156.15.1.69,156.15.1.70,156.15.1.71,156.15.1.72,156.15.1.73,156.15.1.74,156.15.1.75,156.15.1.76,156.15.1.77,156.15.1.78,156.15.1.79,156.15.1.80,156.15.1.81,156.15.1.82,156.15.1.83,156.15.1.84,156.15.1.85,156.15.1.86,156.15.1.87,156.15.1.88,156.15.1.89,156.15.1.90,156.15.1.91,156.15.1.92,156.15.1.93,156.15.1.94,156.15.1.95,156.15.1.96,156.15.1.97,156.15.1.98,156.15.1.99,156.15.1.100,156.15.1.101,156.15.1.102,156.15.1.103,156.15.1.104,156.15.1.105,156.15.1.106,156.15.1.107,156.15.1.108,156.15.1.109,156.15.1.110,156.15.1.111,156.15.1.112,156.15.1.113,156.15.1.114,156.15.1.115,156.15.1.116,156.15.1.117,156.15.1.118,156.15.1.119,156.15.1.120,156.15.1.121,156.15.1.122,156.15.1.123,156.15.1.124,156.15.1.125,156.15.1.126,156.15.1.127,156.15.1.128,156.15.1.129,156.15.1.130,156.15.1.131,156.15.1.132,156.15.1.133,156.15.1.134,156.15.1.135,156.15.1.136,156.15.1.137,156.15.1.138,156.15.1.139,156.15.1.140,156.15.1.141,156.15.1.142,156.15.1.143,156.15.1.144,156.15.1.145,156.15.1.146,156.15.1.147,156.15.1.148,156.15.1.149,156.15.1.150,156.15.1.151,156.15.1.152,156.15.1.153,156.15.1.154,156.15.1.155,156.15.1.156,156.15.1.157,156.15.1.158,156.15.1.159,156.15.1.160,156.15.1.161,156.15.1.162,156.15.1.163,156.15.1.164,156.15.1.165,156.15.1.166,156.15.1.167,156.15.1.168,156.15.1.169,156.15.1.170,156.15.1.171,156.15.1.172,156.15.1.173,156.15.1.174,156.15.1.175,156.15.1.176,156.15.1.177,156.15.1.178,156.15.1.179,156.15.1.180,156.15.1.181,156.15.1.182,156.15.1.183,156.15.1.184,156.15.1.185,156.15.1.186,156.15.1.187,156.15.1.188,156.15.1.189,156.15.1.190,156.15.1.191,156.15.1.192,156.15.1.193,156.15.1.194,156.15.1.195,156.15.1.196,156.15.1.197,156.15.1.198,156.15.1.199,156.15.1.200,156.15.1.201,156.15.1.202,156.15.1.203,156.15.1.204,156.15.1.205,156.15.1.206,156.15.1.207,156.15.1.208,156.15.1.209,156.15.1.210,156.15.1.211,156.15.1.212,156.15.1.213,156.15.1.214,156.15.1.215,156.15.1.216,156.15.1.217,156.15.1.218,156.15.1.219,156.15.1.220,156.15.1.221,156.15.1.222,156.15.1.223,156.15.1.224,156.15.1.225,156.15.1.226,156.15.1.227,156.15.1.228,156.15.1.229,156.15.1.230,156.15.1.231,156.15.1.232,156.15.1.233,156.15.1.234,156.15.1.235,156.15.1.236,156.15.1.237,156.15.1.238,156.15.1.239,156.15.1.240,156.15.1.241,156.15.1.242,156.15.1.243,156.15.1.244,156.15.1.245,156.15.1.246,156.15.1.247,156.15.1.248,156.15.1.249,156.15.1.250,156.15.1.251,156.15.1.252,156.15.1.253,156.15.1.254,156.15.1.255
OS_ENDPOINT_TYPE=internalURL
CI_READY=false
OS_REGION_NAME=RegionOne
SSH_AUTH_SOCK=/tmp/ssh-XXXXXXrXMFNv/agent.3778809
OS_INTERFACE=internal
SSH_AGENT_PID=3778810
OS_AUTH_PLUGIN=password
PWD=/home/citest
LOGNAME=citest
XDG_SESSION_TYPE=tty
MODULESHOME=/usr/share/Modules
MANPATH=/usr/share/man:
_=/usr/bin/env
OS_AUTH_URL=http://169.16.1.181:5000
OS_PROJECT_DOMAIN_NAME=Default
MOTD_SHOWN=pam
HOME=/home/citest
LANG=en_US.UTF-8
https_proxy=http://web-proxy.houston.hpecorp.net:8080
OS_TENANT_NAME=admin
SSH_CONNECTION=169.16.1.40 52968 169.16.1.181 22
XDG_SESSION_CLASS=user
SELINUX_ROLE_REQUESTED=
LESSOPEN=||/usr/bin/lesspipe.sh %s
USER=citest
OS_USERNAME=admin
MODULES_RUN_QUARANTINE=LD_LIBRARY_PATH LD_PRELOAD
LOADEDMODULES=
SELINUX_USE_CURRENT_RANGE=
SHLVL=2
HTTPS_PROXY=http://web-proxy.houston.hpecorp.net:8080
HTTP_PROXY=http://web-proxy.houston.hpecorp.net:8080
XDG_SESSION_ID=1
http_proxy=http://web-proxy.houston.hpecorp.net:8080
OS_USER_DOMAIN_NAME=Default
XDG_RUNTIME_DIR=/run/user/1000
SSH_CLIENT=169.16.1.40 52968 22
OS_PROJECT_NAME=admin
DEBUGINFOD_URLS=https://debuginfod.centos.org/ 
which_declare=declare -f
OS_PASSWORD=I5o2EAAoXCn04ynWjKpzAl747M0hqkZnPhfACGYt
PATH=/home/citest/.local/bin:/home/citest/bin:/usr/share/Modules/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin
SELINUX_LEVEL_REQUESTED=
MODULEPATH=/etc/scl/modulefiles:/usr/share/Modules/modulefiles:/etc/modulefiles:/usr/share/modulefiles
DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus
OS_IDENTITY_API_VERSION=3
MODULES_CMD=/usr/share/Modules/libexec/modulecmd.tcl
BASH_FUNC_ml%%=() {  module ml "$@"
}
BASH_FUNC_which%%=() {  ( alias;
 eval ${which_declare} ) | /usr/bin/which --tty-only --read-alias --read-functions --show-tilde --show-dot $@
}
BASH_FUNC_module%%=() {  eval `/usr/bin/tclsh /usr/share/Modules/libexec/modulecmd.tcl bash "$@"`;
 _mlstatus=$?;
 return $_mlstatus
}
BASH_FUNC_scl%%=() {  if [ "$1" = "load" -o "$1" = "unload" ]; then
 eval "module $@";
 else
 /usr/bin/scl "$@";
 fi
}
+ set -o pipefail
+ echo '***********Running ilo-ipxe gate**********'
***********Running ilo-ipxe gate**********
++ sed -En -e 's/.*inet ([0-9.]+).*/\1/p'
++ ip -f inet addr show eth0
+ myip=169.16.1.181
++ awk '{print $1}'
++ cat /home/citest/hardware_info
+ ilo_ip=169.16.1.14
++ cat /home/citest/hardware_info
++ awk '{print $2}'
+ mac=70:10:6f:b4:cd:b6
++ cat /home/citest/hardware_info
++ awk '{print $3}'
+ pool=169.16.1.114,169.16.1.115
++ cut -d , -f 1
++ echo 169.16.1.114,169.16.1.115
+ str=169.16.1.114
++ cut -d , -f 2
++ echo 169.16.1.114,169.16.1.115
+ end=169.16.1.115
+ sudo sed -i 's/dhcp_provider = none/dhcp_provider = dnsmasq/g' /etc/kolla/ironic-conductor/ironic.conf
+ docker restart ironic_conductor
ironic_conductor
+ docker stop ironic_dnsmasq
ironic_dnsmasq
+ echo 'Configure external DHCP.'
Configure external DHCP.
+ cat
+ sudo cp /tmp/dhcpd.conf /etc/dhcp/dhcpd.conf
+ sudo systemctl restart dhcpd.service
+ echo 'Ironic changes.'
Ironic changes.
+ sudo sed -i '/^\[ilo\]$/,/^\[/ s/^use_web_server_for_images = true/use_web_server_for_images = true\nkernel_append_params = \"ipa-insecure=True\"/' /etc/kolla/ironic-conductor/ironic.conf
+ docker restart ironic_conductor
ironic_conductor
+ neutron subnet-create --name ext-subnet --allocation-pool start=169.16.1.114,end=169.16.1.115 --disable-dhcp --gateway 169.16.1.40 baremetal 169.16.1.0/24
neutron CLI is deprecated and will be removed in the Z cycle. Use openstack CLI instead.
Created a new subnet:
+-------------------+--------------------------------------------------+
| Field             | Value                                            |
+-------------------+--------------------------------------------------+
| allocation_pools  | {"start": "169.16.1.114", "end": "169.16.1.115"} |
| cidr              | 169.16.1.0/24                                    |
| created_at        | 2023-02-14T02:13:20Z                             |
| description       |                                                  |
| dns_nameservers   |                                                  |
| enable_dhcp       | False                                            |
| gateway_ip        | 169.16.1.40                                      |
| host_routes       |                                                  |
| id                | fb696e48-7d08-4c38-90c3-25354712549c             |
| ip_version        | 4                                                |
| ipv6_address_mode |                                                  |
| ipv6_ra_mode      |                                                  |
| name              | ext-subnet                                       |
| network_id        | 0a807a7a-814f-4626-803e-1177deed89de             |
| project_id        | 4f75615cfc41427195dada79b6cf7255                 |
| revision_number   | 0                                                |
| service_types     |                                                  |
| subnetpool_id     |                                                  |
| tags              |                                                  |
| tenant_id         | 4f75615cfc41427195dada79b6cf7255                 |
| updated_at        | 2023-02-14T02:13:20Z                             |
+-------------------+--------------------------------------------------+
+ sleep 5
+ openstack baremetal node create --driver ilo --driver-info ilo_address=169.16.1.14 --driver-info ilo_username=Administrator --driver-info ilo_password=weg0th@ce@r --driver-info ilo_verify_ca=False --boot-interface ilo-ipxe --deploy-interface direct
+------------------------+---------------------------------------------------------------------------------------------------------------------+
| Field                  | Value                                                                                                               |
+------------------------+---------------------------------------------------------------------------------------------------------------------+
| allocation_uuid        | None                                                                                                                |
| automated_clean        | None                                                                                                                |
| bios_interface         | ilo                                                                                                                 |
| boot_interface         | ilo-ipxe                                                                                                            |
| boot_mode              | None                                                                                                                |
| chassis_uuid           | None                                                                                                                |
| clean_step             | {}                                                                                                                  |
| conductor              | host-169-16-1-181                                                                                                   |
| conductor_group        |                                                                                                                     |
| console_enabled        | False                                                                                                               |
| console_interface      | ilo                                                                                                                 |
| created_at             | 2023-02-14T02:13:30+00:00                                                                                           |
| deploy_interface       | direct                                                                                                              |
| deploy_step            | {}                                                                                                                  |
| description            | None                                                                                                                |
| driver                 | ilo                                                                                                                 |
| driver_info            | {'ilo_address': '169.16.1.14', 'ilo_username': 'Administrator', 'ilo_password': '******', 'ilo_verify_ca': 'False'} |
| driver_internal_info   | {}                                                                                                                  |
| extra                  | {}                                                                                                                  |
| fault                  | None                                                                                                                |
| inspect_interface      | ilo                                                                                                                 |
| inspection_finished_at | None                                                                                                                |
| inspection_started_at  | None                                                                                                                |
| instance_info          | {}                                                                                                                  |
| instance_uuid          | None                                                                                                                |
| last_error             | None                                                                                                                |
| lessee                 | None                                                                                                                |
| maintenance            | False                                                                                                               |
| maintenance_reason     | None                                                                                                                |
| management_interface   | ilo                                                                                                                 |
| name                   | None                                                                                                                |
| network_data           | {}                                                                                                                  |
| network_interface      | noop                                                                                                                |
| owner                  | 4f75615cfc41427195dada79b6cf7255                                                                                    |
| power_interface        | ilo                                                                                                                 |
| power_state            | None                                                                                                                |
| properties             | {}                                                                                                                  |
| protected              | False                                                                                                               |
| protected_reason       | None                                                                                                                |
| provision_state        | enroll                                                                                                              |
| provision_updated_at   | None                                                                                                                |
| raid_config            | {}                                                                                                                  |
| raid_interface         | no-raid                                                                                                             |
| rescue_interface       | no-rescue                                                                                                           |
| reservation            | None                                                                                                                |
| resource_class         | None                                                                                                                |
| retired                | False                                                                                                               |
| retired_reason         | None                                                                                                                |
| secure_boot            | None                                                                                                                |
| storage_interface      | noop                                                                                                                |
| target_power_state     | None                                                                                                                |
| target_provision_state | None                                                                                                                |
| target_raid_config     | {}                                                                                                                  |
| traits                 | []                                                                                                                  |
| updated_at             | None                                                                                                                |
| uuid                   | d0c916b8-941a-4b50-a04b-d147f5c7e11d                                                                                |
| vendor_interface       | ilo                                                                                                                 |
+------------------------+---------------------------------------------------------------------------------------------------------------------+
++ tail -n1
++ grep '\w'
++ awk '{print $2}'
++ grep -v UUID
++ openstack baremetal node list
+ NODE=d0c916b8-941a-4b50-a04b-d147f5c7e11d
+ openstack baremetal node set --driver-info deploy_kernel=http://169.16.1.40:9000/kesper-ipa.kernel --driver-info deploy_ramdisk=http://169.16.1.40:9000/kesper-ipa.initramfs --driver-info bootloader=http://169.16.1.40:9000/ir-deploy-redfish.efiboot --instance-info image_source=http://169.16.1.40:9000/rhel009_wholedisk_image.qcow2 --instance-info image_checksum=6d2a8427a4608d1fcc7aa2daed8ad5c6 --instance-info root_gb=25 --property capabilities=boot_mode:uefi --property cpus=1 --property memory_mb=24288 --property local_gb=40 --property cpu_arch=x86_64 d0c916b8-941a-4b50-a04b-d147f5c7e11d
+ openstack baremetal port create --node d0c916b8-941a-4b50-a04b-d147f5c7e11d 70:10:6f:b4:cd:b6
+-----------------------+--------------------------------------+
| Field                 | Value                                |
+-----------------------+--------------------------------------+
| address               | 70:10:6f:b4:cd:b6                    |
| created_at            | 2023-02-14T02:13:42+00:00            |
| extra                 | {}                                   |
| internal_info         | {}                                   |
| is_smartnic           | False                                |
| local_link_connection | {}                                   |
| node_uuid             | d0c916b8-941a-4b50-a04b-d147f5c7e11d |
| physical_network      | None                                 |
| portgroup_uuid        | None                                 |
| pxe_enabled           | True                                 |
| updated_at            | None                                 |
| uuid                  | 85a1ef4a-168a-4853-8b23-2ef07cc827b9 |
+-----------------------+--------------------------------------+
+ openstack baremetal node manage d0c916b8-941a-4b50-a04b-d147f5c7e11d
+ sleep 10
+ openstack baremetal node provide d0c916b8-941a-4b50-a04b-d147f5c7e11d
+ openstack baremetal node power off d0c916b8-941a-4b50-a04b-d147f5c7e11d
+ cd /home/citest/gate-test/tempest
+ export OS_TEST_TIMEOUT=3000
+ OS_TEST_TIMEOUT=3000
++ neutron net-list -F id -f value
neutron CLI is deprecated and will be removed in the Z cycle. Use openstack CLI instead.
+ net_id=0a807a7a-814f-4626-803e-1177deed89de
+ sed -i s/11.11.11.11.11/0a807a7a-814f-4626-803e-1177deed89de/g /home/citest/gate-test/tempest/etc/tempest.conf
+ sudo -E stestr -vvv --debug run --serial ironic_standalone.test_basic_ops.BaremetalIloIPxeWholediskHttpLink.test_ip_access_to_server
initialize_app
prepare_to_run_command Run
{0} ironic_tempest_plugin.tests.scenario.ironic_standalone.test_basic_ops.BaremetalIloIPxeWholediskHttpLink.test_ip_access_to_server [456.339488s] ... ok
clean_up Run

======
Totals
======
Ran: 1 tests in 456.3395 sec.
 - Passed: 1
 - Skipped: 0
 - Expected Fail: 0
 - Unexpected Success: 0
 - Failed: 0
Sum of execute time for each test: 456.3395 sec.

==============
Worker Balance
==============
 - Worker 0 (1 tests) => 0:07:36.339488
+ grep active
+ openstack baremetal node list
| d0c916b8-941a-4b50-a04b-d147f5c7e11d | None | 6ef1004a-92e2-4d4c-b668-7216df5f613a | power on    | active             | False       |
+ '[' 0 -ne 0 ']'
+ echo '***********Successfully passed ilo-ipxe gate**********'
***********Successfully passed ilo-ipxe gate**********
